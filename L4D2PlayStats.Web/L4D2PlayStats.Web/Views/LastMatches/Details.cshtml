@using L4D2PlayStats.Sdk.Matches.Results
@using L4D2PlayStats.Web
@using Microsoft.Extensions.Localization
@model L4D2PlayStats.Web.Models.MatchDetailsModel
@inject IStringLocalizer<SharedResource> SharedLocalizer

@section Styles {
    <style>
        .maps .label {
            margin: 0 3px;
        }
    </style>
}

@if (Model.Statistics.Count == 0)
{
    <div class="row">
        <div class="col-xs-12">
            <h4 class="text-center">
                @SharedLocalizer["NoMatchFound"]
            </h4>
        </div>
    </div>
    return;
}

<h4 class="text-center">@SharedLocalizer["MatchDetails"]</h4>

<div class="maps">
    <div class="panel panel-default">
        <div class="panel-heading">@SharedLocalizer["Maps"]</div>
        <div class="panel-body">
            @SharedLocalizer["MatchStatsTitle"]
        </div>
        <table class="table table-striped table-hover table-condensed table-responsive">
            <thead>
            <th class="text-center">#</th>
            <th class="text-center">@SharedLocalizer["Start"]</th>
            <th class="text-center">@SharedLocalizer["End"]</th>
            <th class="text-center">@SharedLocalizer["Elapsed"]</th>
            <th class="text-center">@SharedLocalizer["Map"]</th>
            <th class="text-center slim" colspan="3">@SharedLocalizer["Scoreboard"]</th>
            </thead>
            <tbody>
            @for (var i = 0; i < Model.Statistics.Count; i++)
            {
                var result = Model.Statistics[i];
                var statistic = result.Statistic;
                var gameRound = statistic?.GameRound;
                var scoring = statistic?.Scoring;
                var labelTeamA = scoring?.Draw == true ? "default" : scoring?.TeamAWon == true ? "success" : "danger";
                var labelTeamB = scoring?.Draw == true ? "default" : scoring?.TeamBWon == true ? "success" : "danger";

                <tr>
                    <td class="text-center" data-label="#">#@(i + 1)</td>
                    <td class="text-center" data-label="@SharedLocalizer["Start"]">@statistic?.MapStart?.ToString("d") @statistic?.MapStart?.ToString("HH:mm")</td>
                    <td class="text-center" data-label="@SharedLocalizer["End"]">@statistic?.MapEnd?.ToString("d") @statistic?.MapEnd?.ToString("HH:mm")</td>
                    <td class="text-center" data-label="@SharedLocalizer["Elapsed"]">@statistic?.MapElapsed?.ToString(@"hh\:mm\:ss")</td>
                    <td class="text-center" data-label="@SharedLocalizer["Map"]">@gameRound?.MapName</td>
                    <td class="text-center slim" data-label="@SharedLocalizer["TeamAScore"]">
                        <span class="label label-@labelTeamA" data-toggle="tooltip" data-placement="top" title="@SharedLocalizer["TeamAScore"]">
                            @scoring?.TeamA?.Score.ToString("N0")
                        </span>
                    </td>
                    <td class="text-center slim" data-label="@SharedLocalizer["ScoreDifference"]">
                        <span class="label label-default" data-toggle="tooltip" data-placement="top" title="@SharedLocalizer["ScoreDifference"]">
                            @scoring?.ScoreDiff?.ToString("N0")
                        </span>
                    </td>
                    <td class="text-center slim" data-label="@SharedLocalizer["TeamBScore"]">
                        <span class="label label-@labelTeamB" data-toggle="tooltip" data-placement="top" title="@SharedLocalizer["TeamBScore"]">
                            @scoring?.TeamB?.Score.ToString("N0")
                        </span>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>

<div class="match">
    @await Html.PartialAsync("_Match", Model.Match)
</div>

@foreach (var team in Model.Match.Teams ?? new List<MatchResult.TeamResult>())
{
    <div class="panel panel-default">
        <div class="panel-heading">@SharedLocalizer["Team"] @team.Code - @SharedLocalizer["Survivor"]</div>
        <div class="panel-body">
            @string.Format(SharedLocalizer["TeamStatisticsAsSurvivor"], team.Code)
        </div>
        <table class="table table-striped table-hover table-condensed table-responsive">
            <thead>
            <th class="text-center"></th>
            @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
            {
                <th class="text-center" colspan="2">@player.Name</th>
            }
            <th class="text-center">@SharedLocalizer["Total"]</th>
            </thead>
            <tbody>
            <tr>
                <td>@SharedLocalizer["MvpSI"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.MvpSiDamage.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.MvpSiDamagePercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.MvpSiDamage.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["MvpCommon"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.MvpCommon.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.MvpCommonPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.MvpCommon.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["LvpFf"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.LvpFfGiven.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.LvpFfGivenPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.LvpFfGiven.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["Deaths"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.Died.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.DiedPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.Died.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["TimesIncapacitated"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.Incaps.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.IncapsPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.Incaps.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["DamageTaken"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.DmgTaken.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.DmgTakenPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.DmgTaken.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["CommonsKilled"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.Common.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.CommonPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.Common.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["SiKilled"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.SiKilled.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.SiKilledPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.SiKilled.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["SiDamageDealt"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.SiDamage.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.SiDamagePercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.SiDamage.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["TankDamageDealt"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.TankDamage.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.TankDamagePercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.TankDamage.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["TankRocksTaken"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.RockEats.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.RockEatsPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.RockEats.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["Skeets"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.Skeets.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.SkeetsPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.Skeets.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["Levels"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.Levels.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.LevelsPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.Levels.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["FF"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.FfGiven.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.FfGivenPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.FfGiven.ToString("N0")</td>
            </tr>
            </tbody>
        </table>
    </div>
}

@foreach (var team in Model.Match.Teams ?? new List<MatchResult.TeamResult>())
{
    <div class="panel panel-default">
        <div class="panel-heading">@SharedLocalizer["Team"] @team.Code - @SharedLocalizer["Infected"]</div>
        <div class="panel-body">
            @string.Format(SharedLocalizer["TeamStatisticsAsInfected"], team.Code)
        </div>
        <table class="table table-striped table-hover table-condensed table-responsive">
            <thead>
            <th class="text-center"></th>
            @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
            {
                <th class="text-center" colspan="2">@player.Name</th>
            }
            <th class="text-center">@SharedLocalizer["Total"]</th>
            </thead>
            <tbody>
            <tr>
                <td>@SharedLocalizer["TotalDamage"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.DmgTotal.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.DmgTotalPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.DmgTotal.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["TankDamageDealt"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.DmgTank.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.DmgTankPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.DmgTank.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["DamageSpitter"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.DmgSpit.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.DmgSpitPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.DmgSpit.ToString("N0")</td>
            </tr>

            <tr>
                <td>@SharedLocalizer["HunterPounceDamage"]</td>
                @foreach (var player in team.Players ?? new List<MatchResult.PlayerResult>())
                {
                    <td class="text-right" data-label="@player.Name">
                        @player.HunterDpDmg.ToString("N0")
                    </td>
                    <td class="text-left hide-mobile">
                        @player.HunterDpDmgPercentage.ToString("P0")
                    </td>
                }
                <td class="text-center" data-label="@SharedLocalizer["Total"]">@team.HunterDpDmg.ToString("N0")</td>
            </tr>
            </tbody>
        </table>
    </div>
}