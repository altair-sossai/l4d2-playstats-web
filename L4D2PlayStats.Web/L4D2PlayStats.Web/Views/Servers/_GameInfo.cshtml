@using L4D2PlayStats.Web
@using Microsoft.Extensions.Localization
@model L4D2PlayStats.Web.Models.ServerInfoModel
@inject IStringLocalizer<SharedResource> SharedLocalizer
@{
    var serverInfo = Model.ServerInfo;
    var gameInfo = Model.GameInfo;
    var configuration = gameInfo.Configuration;
    var round = gameInfo.Round;
    var scoreboard = gameInfo.Scoreboard;
}

<h4 class="text-center">@SharedLocalizer["Servers"]</h4>

<div class="panel panel-default">
    <div class="panel-heading text-center">
        @{
            var header = new List<string>();

            if (serverInfo != null && !string.IsNullOrEmpty(serverInfo.Name))
                header.Add(serverInfo.Name);

            if (configuration != null && !string.IsNullOrEmpty(configuration.Name))
                header.Add(configuration.Name);

            if (configuration is { TeamSize: > 0 })
                header.Add($"{configuration.TeamSize}v{configuration.TeamSize}");
        }

        @string.Join(" - ", header)
    </div>

    <table class="table table-condensed table-responsive">
        <tbody>
        <tr>
            <th class="slim text-right">@SharedLocalizer["ServerIP"]:</th>
            <td data-label="@SharedLocalizer["ServerIP"]:">@Model.ServerIp</td>

            <th class="slim text-right">@SharedLocalizer["Players"]:</th>
            <td data-label="@SharedLocalizer["Players"]:">
                @((serverInfo?.Players ?? 0).ToString("N0")) / @((serverInfo?.MaxPlayers ?? 0).ToString("N0"))
            </td>

            <th class="slim text-right">@SharedLocalizer["Map"]:</th>
            <td data-label="@SharedLocalizer["Map"]:">
                @{
                    var map = new List<string>();

                    if (!string.IsNullOrEmpty(serverInfo?.Map))
                        map.Add(serverInfo.Map);

                    if (round != null)
                        map.Add(round.AreTeamsFlipped ? "2º round" : "1º round");
                }

                @string.Join(" - ", map)
            </td>
        </tr>
        <tr>
            @{
                var survivorScore = scoreboard?.SurvivorScore ?? 0;
                var infectedScore = scoreboard?.InfectedScore ?? 0;
                var labelSurvivor = scoreboard?.IsDraw == true ? "default" : scoreboard?.IsSurvivorsWinning == true ? "success" : "danger";
                var labelInfected = scoreboard?.IsDraw == true ? "default" : scoreboard?.IsInfectedsWinning == true ? "success" : "danger";
            }
            <th class="slim text-right">Survivor score:</th>
            <td data-label="Survivor / Infected score:">
                <span class="label label-@labelSurvivor">
                    @survivorScore.ToString("N0")
                </span>
                <span style="margin: 0 10px"> / </span>
                <span class="label label-@labelInfected">
                    @infectedScore.ToString("N0")
                </span>
            </td>

            <th class="slim text-right">Progress:</th>
            <td data-label="Progress:">
                @((scoreboard?.CurrentProgressPoints ?? 0).ToString("N0"))
                <span> / </span>
                @((round?.MaxChapterProgressPoints ?? 0).ToString("N0"))
                <span class="label label-default">
                    @((scoreboard?.CurrentProgress ?? 0).ToString("P0"))
                </span>
            </td>

            <th class="slim text-right">Bonus:</th>
            <td data-label="Bonus:">
                @((scoreboard?.Bonus ?? 0).ToString("N0"))
                <span> / </span>
                @((scoreboard?.MaxBonus ?? 0).ToString("N0"))
                <span class="label label-default">
                    @((scoreboard?.BonusPercentage ?? 0).ToString("P0"))
                </span>
            </td>
        </tr>
        <tr>
            <th class="slim text-right">Comeback:</th>
            <td data-label="Comeback:">
                <span class="label label-default">
                    @((scoreboard?.Comeback ?? 0).ToString("N0"))
                </span>
            </td>

            <th class="slim text-right">Tank percent:</th>
            <td data-label="Tank percent:">@((round?.TankPercent ?? 0).ToString("P0"))</td>

            <th class="slim text-right">Witch percent:</th>
            <td data-label="Witch percent:">@((round?.WitchPercent ?? 0).ToString("P0"))</td>
        </tr>
        </tbody>
    </table>
</div>