@using L4D2PlayStats.Infrastructure.Extensions
@using L4D2PlayStats.UserAvatar
@using L4D2PlayStats.Web.Models
@model List<L4D2PlayStats.Sdk.Ranking.Results.PlayerResult>
@inject IUserAvatar UserAvatar

@section Styles {
    <style>
        .col-xs-3, .col-xs-4 {
            padding-right: 5px;
            padding-left: 5px;
        }

        .progress {
            margin: 0;
            height: 10px;
        }

        .progress-bar-danger {
            background-color: #f57b7b;
            border: 1px solid #1c1e22;
        }

        table {
            margin-bottom: 0 !important;
        }

        p {
            margin-bottom: 0 !important;
        }
    </style>
}

<h4 class="text-center">Top players</h4>
<div class="row">
    @foreach (var player in Model.Take(3))
    {
        var patentInfo = new PatentInfoModel(player);
        var patent = patentInfo.Patent;

        <div class="col-xs-4">
            <div class="thumbnail">
                <h5 class="text-center bold">
                    TOP #@player.Position
                </h5>
                <img src="@UserAvatar[player.CommunityId]" alt="@player.Name" class="img-responsive img-thumbnail"/>
                <div class="caption">
                    <h5 class="text-center">
                        <img src="@patent.Image" alt="@patent.FullName" data-toggle="tooltip" data-placement="top" title="@patent.FullName" style="width: 45px"/>
                        @player.Name
                    </h5>
                    <table class="table table-striped table-hover table-condensed">
                        <tr>
                            <td colspan="4">
                                <div class="progress" data-toggle="tooltip" data-placement="top" data-html="true" title="@patentInfo.Tooltip">
                                    <div class="progress-bar progress-bar-@patentInfo.ProgressBarType" role="progressbar" style="width: @patentInfo.ProgressBarWidth%;">
                                    </div>
                                    @if (patentInfo.ShowPreviousExperienceProgressBar)
                                    {
                                        <div class="progress-bar progress-bar-@patentInfo.PreviousExperienceProgressBarType" role="progressbar" style="width: @patentInfo.PreviousExperienceProgressBarWidth%;">
                                        </div>
                                    }
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>Level:</th>
                            <td class="text-right">@patent.Level</td>
                            <th>MVP's:</th>
                            <td class="text-right">@player.Mvps</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    }
</div>

<div class="row">
    @foreach (var player in Model.Skip(3).Take(4))
    {
        var patentInfo = new PatentInfoModel(player);
        var patent = patentInfo.Patent;

        <div class="col-xs-3">
            <div class="thumbnail">
                <p class="text-center">
                    TOP #@player.Position
                </p>
                <img src="@UserAvatar[player.CommunityId]" alt="@player.Name" class="img-responsive img-thumbnail"/>
                <p class="text-center">
                    <img src="@patent.Image" alt="@patent.FullName" data-toggle="tooltip" data-placement="top" title="@patent.FullName" style="width: 45px"/>
                    @player.Name
                </p>
                <div class="caption">
                    <table class="table table-striped table-hover table-condensed">
                        <td colspan="4">
                            <div class="progress" data-toggle="tooltip" data-placement="top" data-html="true" title="@patentInfo.Tooltip">
                                <div class="progress-bar progress-bar-@patentInfo.ProgressBarType" role="progressbar" style="width: @patentInfo.ProgressBarWidth%;">
                                </div>
                                @if (patentInfo.ShowPreviousExperienceProgressBar)
                                {
                                    <div class="progress-bar progress-bar-@patentInfo.PreviousExperienceProgressBarType" role="progressbar" style="width: @patentInfo.PreviousExperienceProgressBarWidth%;">
                                    </div>
                                }
                            </div>
                        </td>
                        <tr>
                            <th>Level:</th>
                            <td class="text-right">@patent.Level</td>
                            <th>MVP's:</th>
                            <td class="text-right">@player.Mvps</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    }
</div>

<hr/>

<h5 class="text-center">Top 50 players</h5>
<table class="table table-striped table-hover table-bordered table-condensed">
    <thead>
    <tr>
        <th class="text-center">#</th>
        <th class="text-center">Patent</th>
        <th colspan="2">Player</th>
        <th class="text-center" style="min-width: 90px">XP</th>
        <th class="text-center">Wins</th>
        <th class="text-center">Loss</th>
        <th class="text-center">MVP's</th>
        <th class="text-center">Win rate</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var player in Model.Take(50))
    {
        var patentInfo = new PatentInfoModel(player);
        var patent = patentInfo.Patent;

        <tr class="hover">
            <td class="text-center vertical-align-middle">#@player.Position</td>
            <td class="text-center vertical-align-middle" style="width: 1px">
                <img src="@patent.Image" alt="@patent.FullName" data-toggle="tooltip" data-placement="top" title="@patent.FullName" style="width: 32px"/>
            </td>
            <td class="text-center" style="width: 1px">
                <img src="@UserAvatar[player.CommunityId]" alt="@player.Name" style="width: 32px"/>
            </td>
            <td class="vertical-align-middle">@player.Name?.Truncate(30)</td>
            <td class="text-center vertical-align-middle">
                <div class="progress" data-toggle="tooltip" data-placement="top" data-html="true" title="@patentInfo.Tooltip">
                    <div class="progress-bar progress-bar-@patentInfo.ProgressBarType" role="progressbar" style="width: @patentInfo.ProgressBarWidth%;">
                    </div>
                    @if (patentInfo.ShowPreviousExperienceProgressBar)
                    {
                        <div class="progress-bar progress-bar-@patentInfo.PreviousExperienceProgressBarType" role="progressbar" style="width: @patentInfo.PreviousExperienceProgressBarWidth%;">
                        </div>
                    }
                </div>
            </td>
            <td class="text-center vertical-align-middle">
                <p data-toggle="tooltip" data-placement="top" title="Wins">
                    @player.Wins
                </p>
            </td>
            <td class="text-center vertical-align-middle">
                <p data-toggle="tooltip" data-placement="top" title="Loss">
                    @player.Loss
                </p>
            </td>
            <td class="text-center vertical-align-middle">
                <p data-toggle="tooltip" data-placement="top" title="MVP's">
                    @player.Mvps
                </p>
            </td>
            <td class="text-center vertical-align-middle">
                <p data-toggle="tooltip" data-placement="top" title="Win rate">
                    @player.WinRate.ToString("P0")
                </p>
            </td>
        </tr>
    }
    </tbody>
</table>